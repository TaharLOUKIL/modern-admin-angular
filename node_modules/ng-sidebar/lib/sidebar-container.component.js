"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var common_1 = require("@angular/common");
// Based on https://github.com/angular/material2/tree/master/src/lib/sidenav
var ɵngcc0 = require('@angular/core');
var ɵngcc1 = require('@angular/common');

function SidebarContainer_div_0_Template(rf, ctx) { if (rf & 1) {
    var _r2 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 2);
    ɵngcc0.ɵɵlistener("click", function SidebarContainer_div_0_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r2); var ctx_r1 = ɵngcc0.ɵɵnextContext(); return ctx_r1._onBackdropClicked(); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngClass", ctx_r0.backdropClass);
} }
var _c0 = [[["ng-sidebar"], ["", "ng-sidebar", ""]], [["", "ng-sidebar-content", ""]]];
var _c1 = ["ng-sidebar,[ng-sidebar]", "[ng-sidebar-content]"];
var SidebarContainer = /** @class */ (function () {
    function SidebarContainer(_ref, platformId) {
        this._ref = _ref;
        this.animate = true;
        this.allowSidebarBackdropControl = true;
        this.showBackdrop = false;
        this.showBackdropChange = new core_1.EventEmitter();
        this.onBackdropClicked = new core_1.EventEmitter();
        this._sidebars = [];
        this._isBrowser = common_1.isPlatformBrowser(platformId);
    }
    SidebarContainer.prototype.ngAfterContentInit = function () {
        if (!this._isBrowser) {
            return;
        }
        this._onToggle();
    };
    SidebarContainer.prototype.ngOnChanges = function (changes) {
        if (!this._isBrowser) {
            return;
        }
        if (changes['showBackdrop']) {
            this.showBackdropChange.emit(changes['showBackdrop'].currentValue);
        }
    };
    SidebarContainer.prototype.ngOnDestroy = function () {
        if (!this._isBrowser) {
            return;
        }
        this._unsubscribe();
    };
    /**
     * @internal
     *
     * Adds a sidebar to the container's list of sidebars.
     *
     * @param sidebar {Sidebar} A sidebar within the container to register.
     */
    SidebarContainer.prototype._addSidebar = function (sidebar) {
        this._sidebars.push(sidebar);
        this._subscribe(sidebar);
    };
    /**
     * @internal
     *
     * Removes a sidebar from the container's list of sidebars.
     *
     * @param sidebar {Sidebar} The sidebar to remove.
     */
    SidebarContainer.prototype._removeSidebar = function (sidebar) {
        var index = this._sidebars.indexOf(sidebar);
        if (index !== -1) {
            this._sidebars.splice(index, 1);
        }
    };
    /**
     * @internal
     *
     * Computes `margin` value to push page contents to accommodate open sidebars as needed.
     *
     * @return {CSSStyleDeclaration} margin styles for the page content.
     */
    SidebarContainer.prototype._getContentStyle = function () {
        var left = 0, right = 0, top = 0, bottom = 0;
        var transformStyle = '';
        var heightStyle = '';
        var widthStyle = '';
        for (var _i = 0, _a = this._sidebars; _i < _a.length; _i++) {
            var sidebar = _a[_i];
            // Slide mode: we need to translate the entire container
            if (sidebar._isModeSlide) {
                if (sidebar.opened) {
                    var transformDir = sidebar._isLeftOrRight ? 'X' : 'Y';
                    var transformAmt = "" + (sidebar._isLeftOrTop ? '' : '-') + (sidebar._isLeftOrRight ? sidebar._width : sidebar._height);
                    transformStyle = "translate" + transformDir + "(" + transformAmt + "px)";
                }
            }
            // Create a space for the sidebar
            if ((sidebar._isModePush && sidebar.opened) || sidebar.dock) {
                var paddingAmt = 0;
                if (sidebar._isModeSlide && sidebar.opened) {
                    if (sidebar._isLeftOrRight) {
                        widthStyle = '100%';
                    }
                    else {
                        heightStyle = '100%';
                    }
                }
                else {
                    if (sidebar._isDocked || (sidebar._isModeOver && sidebar.dock)) {
                        paddingAmt = sidebar._dockedSize;
                    }
                    else {
                        paddingAmt = sidebar._isLeftOrRight ? sidebar._width : sidebar._height;
                    }
                }
                switch (sidebar.position) {
                    case 'left':
                        left = Math.max(left, paddingAmt);
                        break;
                    case 'right':
                        right = Math.max(right, paddingAmt);
                        break;
                    case 'top':
                        top = Math.max(top, paddingAmt);
                        break;
                    case 'bottom':
                        bottom = Math.max(bottom, paddingAmt);
                        break;
                }
            }
        }
        return {
            padding: top + "px " + right + "px " + bottom + "px " + left + "px",
            webkitTransform: transformStyle,
            transform: transformStyle,
            height: heightStyle,
            width: widthStyle
        };
    };
    /**
     * @internal
     *
     * Closes sidebars when the backdrop is clicked, if they have the
     * `closeOnClickBackdrop` option set.
     */
    SidebarContainer.prototype._onBackdropClicked = function () {
        var backdropClicked = false;
        for (var _i = 0, _a = this._sidebars; _i < _a.length; _i++) {
            var sidebar = _a[_i];
            if (sidebar.opened && sidebar.showBackdrop && sidebar.closeOnClickBackdrop) {
                sidebar.close();
                backdropClicked = true;
            }
        }
        if (backdropClicked) {
            this.onBackdropClicked.emit();
        }
    };
    /**
     * Subscribes from a sidebar events to react properly.
     */
    SidebarContainer.prototype._subscribe = function (sidebar) {
        var _this = this;
        sidebar.onOpenStart.subscribe(function () { return _this._onToggle(); });
        sidebar.onOpened.subscribe(function () { return _this._markForCheck(); });
        sidebar.onCloseStart.subscribe(function () { return _this._onToggle(); });
        sidebar.onClosed.subscribe(function () { return _this._markForCheck(); });
        sidebar.onModeChange.subscribe(function () { return _this._markForCheck(); });
        sidebar.onPositionChange.subscribe(function () { return _this._markForCheck(); });
        sidebar._onRerender.subscribe(function () { return _this._markForCheck(); });
    };
    /**
     * Unsubscribes from all sidebars.
     */
    SidebarContainer.prototype._unsubscribe = function () {
        for (var _i = 0, _a = this._sidebars; _i < _a.length; _i++) {
            var sidebar = _a[_i];
            sidebar.onOpenStart.unsubscribe();
            sidebar.onOpened.unsubscribe();
            sidebar.onCloseStart.unsubscribe();
            sidebar.onClosed.unsubscribe();
            sidebar.onModeChange.unsubscribe();
            sidebar.onPositionChange.unsubscribe();
            sidebar._onRerender.unsubscribe();
        }
    };
    /**
     * Check if we should show the backdrop when a sidebar is toggled.
     */
    SidebarContainer.prototype._onToggle = function () {
        var _this = this;
        if (this._sidebars.length > 0 && this.allowSidebarBackdropControl) {
            // Show backdrop if a single open sidebar has it set
            var hasOpen = this._sidebars.some(function (sidebar) { return sidebar.opened && sidebar.showBackdrop; });
            this.showBackdrop = hasOpen;
            this.showBackdropChange.emit(hasOpen);
        }
        setTimeout(function () {
            _this._markForCheck();
        });
    };
    /**
     * Triggers change detection to recompute styles.
     */
    SidebarContainer.prototype._markForCheck = function () {
        this._ref.markForCheck();
    };
    /** @nocollapse */
    SidebarContainer.ctorParameters = function () { return [
        { type: core_1.ChangeDetectorRef },
        { type: Object, decorators: [{ type: core_1.Inject, args: [core_1.PLATFORM_ID,] }] }
    ]; };
    SidebarContainer.propDecorators = {
        animate: [{ type: core_1.Input }],
        allowSidebarBackdropControl: [{ type: core_1.Input }],
        showBackdrop: [{ type: core_1.Input }],
        showBackdropChange: [{ type: core_1.Output }],
        onBackdropClicked: [{ type: core_1.Output }],
        contentClass: [{ type: core_1.Input }],
        backdropClass: [{ type: core_1.Input }]
    };
SidebarContainer.ɵfac = function SidebarContainer_Factory(t) { return new (t || SidebarContainer)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(core_1.PLATFORM_ID)); };
SidebarContainer.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: SidebarContainer, selectors: [["ng-sidebar-container"]], inputs: { animate: "animate", allowSidebarBackdropControl: "allowSidebarBackdropControl", showBackdrop: "showBackdrop", contentClass: "contentClass", backdropClass: "backdropClass" }, outputs: { showBackdropChange: "showBackdropChange", onBackdropClicked: "onBackdropClicked" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], ngContentSelectors: _c1, decls: 4, vars: 5, consts: [["aria-hidden", "true", "class", "ng-sidebar__backdrop", 3, "ngClass", "click", 4, "ngIf"], [1, "ng-sidebar__content", 3, "ngClass", "ngStyle"], ["aria-hidden", "true", 1, "ng-sidebar__backdrop", 3, "ngClass", "click"]], template: function SidebarContainer_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c0);
        ɵngcc0.ɵɵtemplate(0, SidebarContainer_div_0_Template, 1, 1, "div", 0);
        ɵngcc0.ɵɵprojection(1);
        ɵngcc0.ɵɵelementStart(2, "div", 1);
        ɵngcc0.ɵɵprojection(3, 1);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", ctx.showBackdrop);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵclassProp("ng-sidebar__content--animate", ctx.animate);
        ɵngcc0.ɵɵproperty("ngClass", ctx.contentClass)("ngStyle", ctx._getContentStyle());
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgClass, ɵngcc1.NgStyle], styles: ["[_nghost-%COMP%] {\n      box-sizing: border-box;\n      display: block;\n      position: relative;\n      height: 100%;\n      width: 100%;\n      overflow: hidden;\n    }\n\n    .ng-sidebar__backdrop[_ngcontent-%COMP%] {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background: #000;\n      opacity: 0.75;\n      pointer-events: auto;\n      z-index: 1;\n    }\n\n    .ng-sidebar__content[_ngcontent-%COMP%] {\n      -webkit-overflow-scrolling: touch;\n      overflow: auto;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n    }\n\n    .ng-sidebar__content--animate[_ngcontent-%COMP%] {\n      -webkit-transition: -webkit-transform 0.3s cubic-bezier(0, 0, 0.3, 1), padding 0.3s cubic-bezier(0, 0, 0.3, 1);\n      transition: transform 0.3s cubic-bezier(0, 0, 0.3, 1), padding 0.3s cubic-bezier(0, 0, 0.3, 1);\n    }"], changeDetection: 0 });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(SidebarContainer, [{
        type: core_1.Component,
        args: [{
                selector: 'ng-sidebar-container',
                template: "\n    <div *ngIf=\"showBackdrop\"\n      aria-hidden=\"true\"\n      class=\"ng-sidebar__backdrop\"\n      [ngClass]=\"backdropClass\"\n      (click)=\"_onBackdropClicked()\"></div>\n\n    <ng-content select=\"ng-sidebar,[ng-sidebar]\"></ng-content>\n\n    <div class=\"ng-sidebar__content\"\n      [class.ng-sidebar__content--animate]=\"animate\"\n      [ngClass]=\"contentClass\"\n      [ngStyle]=\"_getContentStyle()\">\n      <ng-content select=\"[ng-sidebar-content]\"></ng-content>\n    </div>\n  ",
                styles: ["\n    :host {\n      box-sizing: border-box;\n      display: block;\n      position: relative;\n      height: 100%;\n      width: 100%;\n      overflow: hidden;\n    }\n\n    .ng-sidebar__backdrop {\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background: #000;\n      opacity: 0.75;\n      pointer-events: auto;\n      z-index: 1;\n    }\n\n    .ng-sidebar__content {\n      -webkit-overflow-scrolling: touch;\n      overflow: auto;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n    }\n\n    .ng-sidebar__content--animate {\n      -webkit-transition: -webkit-transform 0.3s cubic-bezier(0, 0, 0.3, 1), padding 0.3s cubic-bezier(0, 0, 0.3, 1);\n      transition: transform 0.3s cubic-bezier(0, 0, 0.3, 1), padding 0.3s cubic-bezier(0, 0, 0.3, 1);\n    }\n  "],
                changeDetection: core_1.ChangeDetectionStrategy.OnPush
            }]
    }], function () { return [{ type: ɵngcc0.ChangeDetectorRef }, { type: Object, decorators: [{
                type: core_1.Inject,
                args: [core_1.PLATFORM_ID]
            }] }]; }, { animate: [{
            type: core_1.Input
        }], allowSidebarBackdropControl: [{
            type: core_1.Input
        }], showBackdrop: [{
            type: core_1.Input
        }], showBackdropChange: [{
            type: core_1.Output
        }], onBackdropClicked: [{
            type: core_1.Output
        }], contentClass: [{
            type: core_1.Input
        }], backdropClass: [{
            type: core_1.Input
        }] }); })();
    return SidebarContainer;
}());
exports.SidebarContainer = SidebarContainer;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZWJhci1jb250YWluZXIuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyJzaWRlYmFyLWNvbnRhaW5lci5jb21wb25lbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQVFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBTTtBQUNOO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xudmFyIGNvbW1vbl8xID0gcmVxdWlyZShcIkBhbmd1bGFyL2NvbW1vblwiKTtcbi8vIEJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL21hdGVyaWFsMi90cmVlL21hc3Rlci9zcmMvbGliL3NpZGVuYXZcbnZhciBTaWRlYmFyQ29udGFpbmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNpZGViYXJDb250YWluZXIoX3JlZiwgcGxhdGZvcm1JZCkge1xuICAgICAgICB0aGlzLl9yZWYgPSBfcmVmO1xuICAgICAgICB0aGlzLmFuaW1hdGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmFsbG93U2lkZWJhckJhY2tkcm9wQ29udHJvbCA9IHRydWU7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tkcm9wID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hvd0JhY2tkcm9wQ2hhbmdlID0gbmV3IGNvcmVfMS5FdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vbkJhY2tkcm9wQ2xpY2tlZCA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuX3NpZGViYXJzID0gW107XG4gICAgICAgIHRoaXMuX2lzQnJvd3NlciA9IGNvbW1vbl8xLmlzUGxhdGZvcm1Ccm93c2VyKHBsYXRmb3JtSWQpO1xuICAgIH1cbiAgICBTaWRlYmFyQ29udGFpbmVyLnByb3RvdHlwZS5uZ0FmdGVyQ29udGVudEluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5faXNCcm93c2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fb25Ub2dnbGUoKTtcbiAgICB9O1xuICAgIFNpZGViYXJDb250YWluZXIucHJvdG90eXBlLm5nT25DaGFuZ2VzID0gZnVuY3Rpb24gKGNoYW5nZXMpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9pc0Jyb3dzZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhbmdlc1snc2hvd0JhY2tkcm9wJ10pIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd0JhY2tkcm9wQ2hhbmdlLmVtaXQoY2hhbmdlc1snc2hvd0JhY2tkcm9wJ10uY3VycmVudFZhbHVlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2lkZWJhckNvbnRhaW5lci5wcm90b3R5cGUubmdPbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5faXNCcm93c2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdW5zdWJzY3JpYmUoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqXG4gICAgICogQWRkcyBhIHNpZGViYXIgdG8gdGhlIGNvbnRhaW5lcidzIGxpc3Qgb2Ygc2lkZWJhcnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2lkZWJhciB7U2lkZWJhcn0gQSBzaWRlYmFyIHdpdGhpbiB0aGUgY29udGFpbmVyIHRvIHJlZ2lzdGVyLlxuICAgICAqL1xuICAgIFNpZGViYXJDb250YWluZXIucHJvdG90eXBlLl9hZGRTaWRlYmFyID0gZnVuY3Rpb24gKHNpZGViYXIpIHtcbiAgICAgICAgdGhpcy5fc2lkZWJhcnMucHVzaChzaWRlYmFyKTtcbiAgICAgICAgdGhpcy5fc3Vic2NyaWJlKHNpZGViYXIpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICpcbiAgICAgKiBSZW1vdmVzIGEgc2lkZWJhciBmcm9tIHRoZSBjb250YWluZXIncyBsaXN0IG9mIHNpZGViYXJzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNpZGViYXIge1NpZGViYXJ9IFRoZSBzaWRlYmFyIHRvIHJlbW92ZS5cbiAgICAgKi9cbiAgICBTaWRlYmFyQ29udGFpbmVyLnByb3RvdHlwZS5fcmVtb3ZlU2lkZWJhciA9IGZ1bmN0aW9uIChzaWRlYmFyKSB7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMuX3NpZGViYXJzLmluZGV4T2Yoc2lkZWJhcik7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuX3NpZGViYXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqXG4gICAgICogQ29tcHV0ZXMgYG1hcmdpbmAgdmFsdWUgdG8gcHVzaCBwYWdlIGNvbnRlbnRzIHRvIGFjY29tbW9kYXRlIG9wZW4gc2lkZWJhcnMgYXMgbmVlZGVkLlxuICAgICAqXG4gICAgICogQHJldHVybiB7Q1NTU3R5bGVEZWNsYXJhdGlvbn0gbWFyZ2luIHN0eWxlcyBmb3IgdGhlIHBhZ2UgY29udGVudC5cbiAgICAgKi9cbiAgICBTaWRlYmFyQ29udGFpbmVyLnByb3RvdHlwZS5fZ2V0Q29udGVudFN0eWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGVmdCA9IDAsIHJpZ2h0ID0gMCwgdG9wID0gMCwgYm90dG9tID0gMDtcbiAgICAgICAgdmFyIHRyYW5zZm9ybVN0eWxlID0gJyc7XG4gICAgICAgIHZhciBoZWlnaHRTdHlsZSA9ICcnO1xuICAgICAgICB2YXIgd2lkdGhTdHlsZSA9ICcnO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fc2lkZWJhcnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICB2YXIgc2lkZWJhciA9IF9hW19pXTtcbiAgICAgICAgICAgIC8vIFNsaWRlIG1vZGU6IHdlIG5lZWQgdG8gdHJhbnNsYXRlIHRoZSBlbnRpcmUgY29udGFpbmVyXG4gICAgICAgICAgICBpZiAoc2lkZWJhci5faXNNb2RlU2xpZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2lkZWJhci5vcGVuZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zZm9ybURpciA9IHNpZGViYXIuX2lzTGVmdE9yUmlnaHQgPyAnWCcgOiAnWSc7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2Zvcm1BbXQgPSBcIlwiICsgKHNpZGViYXIuX2lzTGVmdE9yVG9wID8gJycgOiAnLScpICsgKHNpZGViYXIuX2lzTGVmdE9yUmlnaHQgPyBzaWRlYmFyLl93aWR0aCA6IHNpZGViYXIuX2hlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVN0eWxlID0gXCJ0cmFuc2xhdGVcIiArIHRyYW5zZm9ybURpciArIFwiKFwiICsgdHJhbnNmb3JtQW10ICsgXCJweClcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBzcGFjZSBmb3IgdGhlIHNpZGViYXJcbiAgICAgICAgICAgIGlmICgoc2lkZWJhci5faXNNb2RlUHVzaCAmJiBzaWRlYmFyLm9wZW5lZCkgfHwgc2lkZWJhci5kb2NrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhZGRpbmdBbXQgPSAwO1xuICAgICAgICAgICAgICAgIGlmIChzaWRlYmFyLl9pc01vZGVTbGlkZSAmJiBzaWRlYmFyLm9wZW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2lkZWJhci5faXNMZWZ0T3JSaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGhTdHlsZSA9ICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodFN0eWxlID0gJzEwMCUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2lkZWJhci5faXNEb2NrZWQgfHwgKHNpZGViYXIuX2lzTW9kZU92ZXIgJiYgc2lkZWJhci5kb2NrKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZ0FtdCA9IHNpZGViYXIuX2RvY2tlZFNpemU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWRkaW5nQW10ID0gc2lkZWJhci5faXNMZWZ0T3JSaWdodCA/IHNpZGViYXIuX3dpZHRoIDogc2lkZWJhci5faGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN3aXRjaCAoc2lkZWJhci5wb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQgPSBNYXRoLm1heChsZWZ0LCBwYWRkaW5nQW10KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodCA9IE1hdGgubWF4KHJpZ2h0LCBwYWRkaW5nQW10KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd0b3AnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0gTWF0aC5tYXgodG9wLCBwYWRkaW5nQW10KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdib3R0b20nOlxuICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0gTWF0aC5tYXgoYm90dG9tLCBwYWRkaW5nQW10KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGFkZGluZzogdG9wICsgXCJweCBcIiArIHJpZ2h0ICsgXCJweCBcIiArIGJvdHRvbSArIFwicHggXCIgKyBsZWZ0ICsgXCJweFwiLFxuICAgICAgICAgICAgd2Via2l0VHJhbnNmb3JtOiB0cmFuc2Zvcm1TdHlsZSxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtU3R5bGUsXG4gICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFN0eWxlLFxuICAgICAgICAgICAgd2lkdGg6IHdpZHRoU3R5bGVcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqXG4gICAgICogQ2xvc2VzIHNpZGViYXJzIHdoZW4gdGhlIGJhY2tkcm9wIGlzIGNsaWNrZWQsIGlmIHRoZXkgaGF2ZSB0aGVcbiAgICAgKiBgY2xvc2VPbkNsaWNrQmFja2Ryb3BgIG9wdGlvbiBzZXQuXG4gICAgICovXG4gICAgU2lkZWJhckNvbnRhaW5lci5wcm90b3R5cGUuX29uQmFja2Ryb3BDbGlja2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYmFja2Ryb3BDbGlja2VkID0gZmFsc2U7XG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLl9zaWRlYmFyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBzaWRlYmFyID0gX2FbX2ldO1xuICAgICAgICAgICAgaWYgKHNpZGViYXIub3BlbmVkICYmIHNpZGViYXIuc2hvd0JhY2tkcm9wICYmIHNpZGViYXIuY2xvc2VPbkNsaWNrQmFja2Ryb3ApIHtcbiAgICAgICAgICAgICAgICBzaWRlYmFyLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgYmFja2Ryb3BDbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYmFja2Ryb3BDbGlja2VkKSB7XG4gICAgICAgICAgICB0aGlzLm9uQmFja2Ryb3BDbGlja2VkLmVtaXQoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogU3Vic2NyaWJlcyBmcm9tIGEgc2lkZWJhciBldmVudHMgdG8gcmVhY3QgcHJvcGVybHkuXG4gICAgICovXG4gICAgU2lkZWJhckNvbnRhaW5lci5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChzaWRlYmFyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHNpZGViYXIub25PcGVuU3RhcnQuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9vblRvZ2dsZSgpOyB9KTtcbiAgICAgICAgc2lkZWJhci5vbk9wZW5lZC5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX21hcmtGb3JDaGVjaygpOyB9KTtcbiAgICAgICAgc2lkZWJhci5vbkNsb3NlU3RhcnQuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9vblRvZ2dsZSgpOyB9KTtcbiAgICAgICAgc2lkZWJhci5vbkNsb3NlZC5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX21hcmtGb3JDaGVjaygpOyB9KTtcbiAgICAgICAgc2lkZWJhci5vbk1vZGVDaGFuZ2Uuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9tYXJrRm9yQ2hlY2soKTsgfSk7XG4gICAgICAgIHNpZGViYXIub25Qb3NpdGlvbkNoYW5nZS5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX21hcmtGb3JDaGVjaygpOyB9KTtcbiAgICAgICAgc2lkZWJhci5fb25SZXJlbmRlci5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX21hcmtGb3JDaGVjaygpOyB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFVuc3Vic2NyaWJlcyBmcm9tIGFsbCBzaWRlYmFycy5cbiAgICAgKi9cbiAgICBTaWRlYmFyQ29udGFpbmVyLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLl9zaWRlYmFyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBzaWRlYmFyID0gX2FbX2ldO1xuICAgICAgICAgICAgc2lkZWJhci5vbk9wZW5TdGFydC51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgc2lkZWJhci5vbk9wZW5lZC51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgc2lkZWJhci5vbkNsb3NlU3RhcnQudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHNpZGViYXIub25DbG9zZWQudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHNpZGViYXIub25Nb2RlQ2hhbmdlLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICBzaWRlYmFyLm9uUG9zaXRpb25DaGFuZ2UudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHNpZGViYXIuX29uUmVyZW5kZXIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgd2Ugc2hvdWxkIHNob3cgdGhlIGJhY2tkcm9wIHdoZW4gYSBzaWRlYmFyIGlzIHRvZ2dsZWQuXG4gICAgICovXG4gICAgU2lkZWJhckNvbnRhaW5lci5wcm90b3R5cGUuX29uVG9nZ2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5fc2lkZWJhcnMubGVuZ3RoID4gMCAmJiB0aGlzLmFsbG93U2lkZWJhckJhY2tkcm9wQ29udHJvbCkge1xuICAgICAgICAgICAgLy8gU2hvdyBiYWNrZHJvcCBpZiBhIHNpbmdsZSBvcGVuIHNpZGViYXIgaGFzIGl0IHNldFxuICAgICAgICAgICAgdmFyIGhhc09wZW4gPSB0aGlzLl9zaWRlYmFycy5zb21lKGZ1bmN0aW9uIChzaWRlYmFyKSB7IHJldHVybiBzaWRlYmFyLm9wZW5lZCAmJiBzaWRlYmFyLnNob3dCYWNrZHJvcDsgfSk7XG4gICAgICAgICAgICB0aGlzLnNob3dCYWNrZHJvcCA9IGhhc09wZW47XG4gICAgICAgICAgICB0aGlzLnNob3dCYWNrZHJvcENoYW5nZS5lbWl0KGhhc09wZW4pO1xuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuX21hcmtGb3JDaGVjaygpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIFRyaWdnZXJzIGNoYW5nZSBkZXRlY3Rpb24gdG8gcmVjb21wdXRlIHN0eWxlcy5cbiAgICAgKi9cbiAgICBTaWRlYmFyQ29udGFpbmVyLnByb3RvdHlwZS5fbWFya0ZvckNoZWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yZWYubWFya0ZvckNoZWNrKCk7XG4gICAgfTtcbiAgICBTaWRlYmFyQ29udGFpbmVyLmRlY29yYXRvcnMgPSBbXG4gICAgICAgIHsgdHlwZTogY29yZV8xLkNvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3I6ICduZy1zaWRlYmFyLWNvbnRhaW5lcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBcIlxcbiAgICA8ZGl2ICpuZ0lmPVxcXCJzaG93QmFja2Ryb3BcXFwiXFxuICAgICAgYXJpYS1oaWRkZW49XFxcInRydWVcXFwiXFxuICAgICAgY2xhc3M9XFxcIm5nLXNpZGViYXJfX2JhY2tkcm9wXFxcIlxcbiAgICAgIFtuZ0NsYXNzXT1cXFwiYmFja2Ryb3BDbGFzc1xcXCJcXG4gICAgICAoY2xpY2spPVxcXCJfb25CYWNrZHJvcENsaWNrZWQoKVxcXCI+PC9kaXY+XFxuXFxuICAgIDxuZy1jb250ZW50IHNlbGVjdD1cXFwibmctc2lkZWJhcixbbmctc2lkZWJhcl1cXFwiPjwvbmctY29udGVudD5cXG5cXG4gICAgPGRpdiBjbGFzcz1cXFwibmctc2lkZWJhcl9fY29udGVudFxcXCJcXG4gICAgICBbY2xhc3Mubmctc2lkZWJhcl9fY29udGVudC0tYW5pbWF0ZV09XFxcImFuaW1hdGVcXFwiXFxuICAgICAgW25nQ2xhc3NdPVxcXCJjb250ZW50Q2xhc3NcXFwiXFxuICAgICAgW25nU3R5bGVdPVxcXCJfZ2V0Q29udGVudFN0eWxlKClcXFwiPlxcbiAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cXFwiW25nLXNpZGViYXItY29udGVudF1cXFwiPjwvbmctY29udGVudD5cXG4gICAgPC9kaXY+XFxuICBcIixcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBbXCJcXG4gICAgOmhvc3Qge1xcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XFxuICAgICAgZGlzcGxheTogYmxvY2s7XFxuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xcbiAgICAgIGhlaWdodDogMTAwJTtcXG4gICAgICB3aWR0aDogMTAwJTtcXG4gICAgICBvdmVyZmxvdzogaGlkZGVuO1xcbiAgICB9XFxuXFxuICAgIC5uZy1zaWRlYmFyX19iYWNrZHJvcCB7XFxuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xcbiAgICAgIHRvcDogMDtcXG4gICAgICBib3R0b206IDA7XFxuICAgICAgbGVmdDogMDtcXG4gICAgICByaWdodDogMDtcXG4gICAgICBiYWNrZ3JvdW5kOiAjMDAwO1xcbiAgICAgIG9wYWNpdHk6IDAuNzU7XFxuICAgICAgcG9pbnRlci1ldmVudHM6IGF1dG87XFxuICAgICAgei1pbmRleDogMTtcXG4gICAgfVxcblxcbiAgICAubmctc2lkZWJhcl9fY29udGVudCB7XFxuICAgICAgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoO1xcbiAgICAgIG92ZXJmbG93OiBhdXRvO1xcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gICAgICB0b3A6IDA7XFxuICAgICAgYm90dG9tOiAwO1xcbiAgICAgIGxlZnQ6IDA7XFxuICAgICAgcmlnaHQ6IDA7XFxuICAgIH1cXG5cXG4gICAgLm5nLXNpZGViYXJfX2NvbnRlbnQtLWFuaW1hdGUge1xcbiAgICAgIC13ZWJraXQtdHJhbnNpdGlvbjogLXdlYmtpdC10cmFuc2Zvcm0gMC4zcyBjdWJpYy1iZXppZXIoMCwgMCwgMC4zLCAxKSwgcGFkZGluZyAwLjNzIGN1YmljLWJlemllcigwLCAwLCAwLjMsIDEpO1xcbiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjNzIGN1YmljLWJlemllcigwLCAwLCAwLjMsIDEpLCBwYWRkaW5nIDAuM3MgY3ViaWMtYmV6aWVyKDAsIDAsIDAuMywgMSk7XFxuICAgIH1cXG4gIFwiXSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlRGV0ZWN0aW9uOiBjb3JlXzEuQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG4gICAgICAgICAgICAgICAgfSxdIH0sXG4gICAgXTtcbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBTaWRlYmFyQ29udGFpbmVyLmN0b3JQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gW1xuICAgICAgICB7IHR5cGU6IGNvcmVfMS5DaGFuZ2VEZXRlY3RvclJlZiB9LFxuICAgICAgICB7IHR5cGU6IE9iamVjdCwgZGVjb3JhdG9yczogW3sgdHlwZTogY29yZV8xLkluamVjdCwgYXJnczogW2NvcmVfMS5QTEFURk9STV9JRCxdIH1dIH1cbiAgICBdOyB9O1xuICAgIFNpZGViYXJDb250YWluZXIucHJvcERlY29yYXRvcnMgPSB7XG4gICAgICAgIGFuaW1hdGU6IFt7IHR5cGU6IGNvcmVfMS5JbnB1dCB9XSxcbiAgICAgICAgYWxsb3dTaWRlYmFyQmFja2Ryb3BDb250cm9sOiBbeyB0eXBlOiBjb3JlXzEuSW5wdXQgfV0sXG4gICAgICAgIHNob3dCYWNrZHJvcDogW3sgdHlwZTogY29yZV8xLklucHV0IH1dLFxuICAgICAgICBzaG93QmFja2Ryb3BDaGFuZ2U6IFt7IHR5cGU6IGNvcmVfMS5PdXRwdXQgfV0sXG4gICAgICAgIG9uQmFja2Ryb3BDbGlja2VkOiBbeyB0eXBlOiBjb3JlXzEuT3V0cHV0IH1dLFxuICAgICAgICBjb250ZW50Q2xhc3M6IFt7IHR5cGU6IGNvcmVfMS5JbnB1dCB9XSxcbiAgICAgICAgYmFja2Ryb3BDbGFzczogW3sgdHlwZTogY29yZV8xLklucHV0IH1dXG4gICAgfTtcbiAgICByZXR1cm4gU2lkZWJhckNvbnRhaW5lcjtcbn0oKSk7XG5leHBvcnRzLlNpZGViYXJDb250YWluZXIgPSBTaWRlYmFyQ29udGFpbmVyO1xuIl19