import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { ReplaySubject } from 'rxjs';
import { BlockUIActions } from '../constants/block-ui-actions.constant';
import { BlockUIDefaultName } from '../constants/block-ui-default-name.constant';
let BlockUIInstanceService = class BlockUIInstanceService {
    constructor() {
        this.blockUISettings = {};
        this.blockUIInstances = {};
        this.blockUISubject = new ReplaySubject(1);
        this.blockUIObservable = this.blockUISubject.asObservable();
        this.blockUIObservable.subscribe(this.blockUIMiddleware.bind(this));
    }
    getSettings() {
        return this.blockUISettings;
    }
    updateSettings(settings = {}) {
        this.blockUISettings = Object.assign(Object.assign({}, this.blockUISettings), settings);
    }
    decorate(name = BlockUIDefaultName) {
        const blockUI = {
            name,
            isActive: false,
            blockCount: 0,
            start: this.dispatch(this.blockUISubject, BlockUIActions.START, name),
            update: this.dispatch(this.blockUISubject, BlockUIActions.UPDATE, name),
            stop: this.dispatch(this.blockUISubject, BlockUIActions.STOP, name),
            reset: this.dispatch(this.blockUISubject, BlockUIActions.RESET, name),
            resetGlobal: this.dispatch(this.blockUISubject, BlockUIActions.RESET_GLOBAL, name),
            unsubscribe: this.dispatch(this.blockUISubject, BlockUIActions.UNSUBSCRIBE, name)
        };
        this.blockUIInstances[name] = this.blockUIInstances[name] || blockUI;
        return blockUI;
    }
    observe() {
        return this.blockUIObservable;
    }
    clearInstance(instanceName) {
        this.dispatch(this.blockUISubject, BlockUIActions.RESET, instanceName);
    }
    blockUIMiddleware({ action, name }) {
        let isActive = null;
        switch (action) {
            case (BlockUIActions.START):
                isActive = true;
                break;
            case (BlockUIActions.STOP):
            case (BlockUIActions.RESET):
                isActive = false;
                break;
        }
        if (isActive !== null) {
            this.blockUIInstances[name].isActive = isActive;
        }
    }
    dispatch(subject, action, name = BlockUIDefaultName) {
        return (message) => {
            subject.next({
                name,
                action,
                message
            });
        };
    }
};
BlockUIInstanceService = __decorate([
    Injectable()
], BlockUIInstanceService);
export { BlockUIInstanceService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvY2stdWktaW5zdGFuY2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLWJsb2NrLXVpLyIsInNvdXJjZXMiOlsic2VydmljZXMvYmxvY2stdWktaW5zdGFuY2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWMsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQztBQU9qRixJQUFhLHNCQUFzQixHQUFuQyxNQUFhLHNCQUFzQjtJQU1qQztRQUxBLG9CQUFlLEdBQTBCLEVBQUUsQ0FBQztRQUM1QyxxQkFBZ0IsR0FBUSxFQUFFLENBQUM7UUFDbkIsbUJBQWMsR0FBdUIsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUQsc0JBQWlCLEdBQW9CLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxFQUFFLENBQUM7UUFHOUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVELFdBQVc7UUFDVCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDOUIsQ0FBQztJQUVELGNBQWMsQ0FBQyxXQUFrQyxFQUFFO1FBQ2pELElBQUksQ0FBQyxlQUFlLG1DQUFRLElBQUksQ0FBQyxlQUFlLEdBQUssUUFBUSxDQUFFLENBQUM7SUFDbEUsQ0FBQztJQUVELFFBQVEsQ0FBQyxPQUFlLGtCQUFrQjtRQUN4QyxNQUFNLE9BQU8sR0FBRztZQUNkLElBQUk7WUFDSixRQUFRLEVBQUUsS0FBSztZQUNmLFVBQVUsRUFBRSxDQUFDO1lBQ2IsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQztZQUNyRSxNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLGNBQWMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDO1lBQ3ZFLElBQUksRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDbkUsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQztZQUNyRSxXQUFXLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLGNBQWMsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDO1lBQ2xGLFdBQVcsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUM7U0FDckUsQ0FBQztRQUVmLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksT0FBTyxDQUFDO1FBRXJFLE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxPQUFPO1FBQ0wsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFDaEMsQ0FBQztJQUVELGFBQWEsQ0FBQyxZQUFvQjtRQUNoQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN6RSxDQUFDO0lBRU8saUJBQWlCLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFnQjtRQUN0RCxJQUFJLFFBQVEsR0FBWSxJQUFJLENBQUM7UUFFN0IsUUFBUSxNQUFNLEVBQUU7WUFDZCxLQUFLLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQztnQkFDekIsUUFBUSxHQUFHLElBQUksQ0FBQztnQkFDaEIsTUFBTTtZQUVSLEtBQUssQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0IsS0FBSyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUM7Z0JBQ3pCLFFBQVEsR0FBRyxLQUFLLENBQUM7Z0JBQ2pCLE1BQU07U0FDVDtRQUVELElBQUksUUFBUSxLQUFLLElBQUksRUFBRTtZQUNyQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztTQUNqRDtJQUNILENBQUM7SUFFTyxRQUFRLENBQUMsT0FBMkIsRUFBRSxNQUFzQixFQUFFLE9BQWUsa0JBQWtCO1FBQ3JHLE9BQU8sQ0FBQyxPQUFhLEVBQVEsRUFBRTtZQUM3QixPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUNYLElBQUk7Z0JBQ0osTUFBTTtnQkFDTixPQUFPO2FBQ1IsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDO0lBQ0osQ0FBQztDQUNGLENBQUE7QUF4RVksc0JBQXNCO0lBRGxDLFVBQVUsRUFBRTtHQUNBLHNCQUFzQixDQXdFbEM7U0F4RVksc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQmxvY2tVSUFjdGlvbnMgfSBmcm9tICcuLi9jb25zdGFudHMvYmxvY2stdWktYWN0aW9ucy5jb25zdGFudCc7XG5pbXBvcnQgeyBCbG9ja1VJRGVmYXVsdE5hbWUgfSBmcm9tICcuLi9jb25zdGFudHMvYmxvY2stdWktZGVmYXVsdC1uYW1lLmNvbnN0YW50JztcbmltcG9ydCB7IE5nQmxvY2tVSSB9IGZyb20gJy4uL21vZGVscy9ibG9jay11aS5tb2RlbCc7XG5pbXBvcnQgeyBCbG9ja1VJU2V0dGluZ3MgfSBmcm9tICcuLi9tb2RlbHMvYmxvY2stdWktc2V0dGluZ3MubW9kZWwnO1xuaW1wb3J0IHsgQmxvY2tVSUV2ZW50IH0gZnJvbSAnLi4vbW9kZWxzL2Jsb2NrLXVpLWV2ZW50Lm1vZGVsJztcblxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQmxvY2tVSUluc3RhbmNlU2VydmljZSB7XG4gIGJsb2NrVUlTZXR0aW5nczogQmxvY2tVSVNldHRpbmdzIHwgYW55ID0ge307XG4gIGJsb2NrVUlJbnN0YW5jZXM6IGFueSA9IHt9O1xuICBwcml2YXRlIGJsb2NrVUlTdWJqZWN0OiBSZXBsYXlTdWJqZWN0PGFueT4gPSBuZXcgUmVwbGF5U3ViamVjdCgxKTtcbiAgcHJpdmF0ZSBibG9ja1VJT2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxhbnk+ID0gdGhpcy5ibG9ja1VJU3ViamVjdC5hc09ic2VydmFibGUoKTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmJsb2NrVUlPYnNlcnZhYmxlLnN1YnNjcmliZSh0aGlzLmJsb2NrVUlNaWRkbGV3YXJlLmJpbmQodGhpcykpO1xuICB9XG5cbiAgZ2V0U2V0dGluZ3MoKTogQmxvY2tVSVNldHRpbmdzIHwgYW55IHtcbiAgICByZXR1cm4gdGhpcy5ibG9ja1VJU2V0dGluZ3M7XG4gIH1cblxuICB1cGRhdGVTZXR0aW5ncyhzZXR0aW5nczogQmxvY2tVSVNldHRpbmdzIHwgYW55ID0ge30pOiB2b2lkIHtcbiAgICB0aGlzLmJsb2NrVUlTZXR0aW5ncyA9IHsgLi4udGhpcy5ibG9ja1VJU2V0dGluZ3MsIC4uLnNldHRpbmdzIH07XG4gIH1cblxuICBkZWNvcmF0ZShuYW1lOiBzdHJpbmcgPSBCbG9ja1VJRGVmYXVsdE5hbWUpOiBOZ0Jsb2NrVUkge1xuICAgIGNvbnN0IGJsb2NrVUkgPSB7XG4gICAgICBuYW1lLFxuICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgYmxvY2tDb3VudDogMCxcbiAgICAgIHN0YXJ0OiB0aGlzLmRpc3BhdGNoKHRoaXMuYmxvY2tVSVN1YmplY3QsIEJsb2NrVUlBY3Rpb25zLlNUQVJULCBuYW1lKSxcbiAgICAgIHVwZGF0ZTogdGhpcy5kaXNwYXRjaCh0aGlzLmJsb2NrVUlTdWJqZWN0LCBCbG9ja1VJQWN0aW9ucy5VUERBVEUsIG5hbWUpLFxuICAgICAgc3RvcDogdGhpcy5kaXNwYXRjaCh0aGlzLmJsb2NrVUlTdWJqZWN0LCBCbG9ja1VJQWN0aW9ucy5TVE9QLCBuYW1lKSxcbiAgICAgIHJlc2V0OiB0aGlzLmRpc3BhdGNoKHRoaXMuYmxvY2tVSVN1YmplY3QsIEJsb2NrVUlBY3Rpb25zLlJFU0VULCBuYW1lKSxcbiAgICAgIHJlc2V0R2xvYmFsOiB0aGlzLmRpc3BhdGNoKHRoaXMuYmxvY2tVSVN1YmplY3QsIEJsb2NrVUlBY3Rpb25zLlJFU0VUX0dMT0JBTCwgbmFtZSksXG4gICAgICB1bnN1YnNjcmliZTogdGhpcy5kaXNwYXRjaCh0aGlzLmJsb2NrVUlTdWJqZWN0LCBCbG9ja1VJQWN0aW9ucy5VTlNVQlNDUklCRSwgbmFtZSlcbiAgICB9IGFzIE5nQmxvY2tVSTtcblxuICAgIHRoaXMuYmxvY2tVSUluc3RhbmNlc1tuYW1lXSA9IHRoaXMuYmxvY2tVSUluc3RhbmNlc1tuYW1lXSB8fCBibG9ja1VJO1xuXG4gICAgcmV0dXJuIGJsb2NrVUk7XG4gIH1cblxuICBvYnNlcnZlKCk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuYmxvY2tVSU9ic2VydmFibGU7XG4gIH1cblxuICBjbGVhckluc3RhbmNlKGluc3RhbmNlTmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5kaXNwYXRjaCh0aGlzLmJsb2NrVUlTdWJqZWN0LCBCbG9ja1VJQWN0aW9ucy5SRVNFVCwgaW5zdGFuY2VOYW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgYmxvY2tVSU1pZGRsZXdhcmUoeyBhY3Rpb24sIG5hbWUgfTogQmxvY2tVSUV2ZW50KTogdm9pZCB7XG4gICAgbGV0IGlzQWN0aXZlOiBib29sZWFuID0gbnVsbDtcblxuICAgIHN3aXRjaCAoYWN0aW9uKSB7XG4gICAgICBjYXNlIChCbG9ja1VJQWN0aW9ucy5TVEFSVCk6XG4gICAgICAgIGlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgKEJsb2NrVUlBY3Rpb25zLlNUT1ApOlxuICAgICAgY2FzZSAoQmxvY2tVSUFjdGlvbnMuUkVTRVQpOlxuICAgICAgICBpc0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICBpZiAoaXNBY3RpdmUgIT09IG51bGwpIHtcbiAgICAgIHRoaXMuYmxvY2tVSUluc3RhbmNlc1tuYW1lXS5pc0FjdGl2ZSA9IGlzQWN0aXZlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZGlzcGF0Y2goc3ViamVjdDogUmVwbGF5U3ViamVjdDxhbnk+LCBhY3Rpb246IEJsb2NrVUlBY3Rpb25zLCBuYW1lOiBzdHJpbmcgPSBCbG9ja1VJRGVmYXVsdE5hbWUpOiBGdW5jdGlvbiB7XG4gICAgcmV0dXJuIChtZXNzYWdlPzogYW55KTogdm9pZCA9PiB7XG4gICAgICBzdWJqZWN0Lm5leHQoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhY3Rpb24sXG4gICAgICAgIG1lc3NhZ2VcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cbn1cbiJdfQ==