import { __decorate } from "tslib";
import { Directive, Input, OnInit, OnDestroy, ComponentRef, ComponentFactoryResolver, ViewContainerRef, TemplateRef, Renderer2, EmbeddedViewRef } from '@angular/core';
import { BlockUIContentComponent } from '../components/block-ui-content/block-ui-content.component';
import { BlockUIInstanceService } from '../services/block-ui-instance.service';
import { BlockUIDefaultName } from '../constants/block-ui-default-name.constant';
import { BlockUIService } from '../services/block-ui.service';
let BlockUIDirective = class BlockUIDirective {
    constructor(blockUIService, blockUIInstanceService, viewRef, templateRef, renderer, componentFactoryResolver) {
        this.blockUIService = blockUIService;
        this.blockUIInstanceService = blockUIInstanceService;
        this.viewRef = viewRef;
        this.templateRef = templateRef;
        this.renderer = renderer;
        this.componentFactoryResolver = componentFactoryResolver;
    }
    set blockUI(name) { this.blockTarget = name; }
    ;
    set blockUIMessage(message) { this.message = message; }
    ;
    set blockUITemplate(template) { this.template = template; }
    ;
    set blockUIDelayStart(delayStart) {
        this.delayStart = delayStart ? Number(delayStart) : null;
    }
    ;
    set blockUIDelayStop(delayStop) {
        this.delayStop = delayStop ? Number(delayStop) : null;
    }
    ;
    ngOnInit() {
        try {
            this.viewRef.createEmbeddedView(this.templateRef);
            const parentElement = this.getParentElement();
            if (parentElement && !this.isComponentInTemplate(parentElement)) {
                this.renderer.addClass(parentElement, 'block-ui__element');
                this.blockUIComponentRef = this.createComponent();
                let blockUIContent = this.findContentNode(this.viewRef.element.nativeElement);
                if (blockUIContent) {
                    const settings = this.blockUIInstanceService.getSettings();
                    parentElement.appendChild(blockUIContent);
                    this.blockUIComponentRef.instance.className = 'block-ui-wrapper--element';
                    this.blockUIComponentRef.instance.name = this.blockTarget || BlockUIDefaultName;
                    if (this.message)
                        this.blockUIComponentRef.instance.defaultMessage = this.message;
                    if (this.delayStart)
                        this.blockUIComponentRef.instance.delayStart = this.delayStart;
                    if (this.delayStop)
                        this.blockUIComponentRef.instance.delayStop = this.delayStop;
                    if (this.template || settings.template)
                        this.blockUIComponentRef.instance.templateCmp = this.template || settings.template;
                }
            }
        }
        catch (error) {
            console.error('ng-block-ui:', error);
        }
    }
    isComponentInTemplate(element) {
        // Needed because of https://github.com/microsoft/TypeScript/issues/26235
        const targetElement = element || {};
        let { children } = targetElement;
        children = Array.from(children || []).reverse();
        return children.some((el) => el && el.localName === 'block-ui');
    }
    getParentElement() {
        const embeddedView = this.viewRef.get(0);
        return embeddedView.rootNodes[0];
    }
    // Needed for IE (#17)
    findContentNode(element) {
        const nextSibling = element.nextSibling || {};
        const previousSibling = element.previousSibling || {};
        return [
            nextSibling,
            nextSibling.nextSibling,
            previousSibling,
            previousSibling.previousSibling
        ].find((e) => e && e.localName === 'block-ui-content');
    }
    createComponent() {
        const resolvedBlockUIComponent = this.componentFactoryResolver.resolveComponentFactory(BlockUIContentComponent);
        return this.viewRef.createComponent(resolvedBlockUIComponent);
    }
    ngOnDestroy() {
        if (this.blockTarget) {
            this.blockUIService.reset(this.blockTarget);
        }
    }
};
BlockUIDirective.ctorParameters = () => [
    { type: BlockUIService },
    { type: BlockUIInstanceService },
    { type: ViewContainerRef },
    { type: TemplateRef },
    { type: Renderer2 },
    { type: ComponentFactoryResolver }
];
__decorate([
    Input()
], BlockUIDirective.prototype, "blockUI", null);
__decorate([
    Input()
], BlockUIDirective.prototype, "blockUIMessage", null);
__decorate([
    Input()
], BlockUIDirective.prototype, "blockUITemplate", null);
__decorate([
    Input()
], BlockUIDirective.prototype, "blockUIDelayStart", null);
__decorate([
    Input()
], BlockUIDirective.prototype, "blockUIDelayStop", null);
BlockUIDirective = __decorate([
    Directive({ selector: '[blockUI]' })
], BlockUIDirective);
export { BlockUIDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvY2stdWkuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctYmxvY2stdWkvIiwic291cmNlcyI6WyJkaXJlY3RpdmVzL2Jsb2NrLXVpLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFDVCxZQUFZLEVBQ1osd0JBQXdCLEVBQ3hCLGdCQUFnQixFQUNoQixXQUFXLEVBQ1gsU0FBUyxFQUNULGVBQWUsRUFDaEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sMkRBQTJELENBQUM7QUFDcEcsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDL0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDakYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBRzlELElBQWEsZ0JBQWdCLEdBQTdCLE1BQWEsZ0JBQWdCO0lBdUIzQixZQUNVLGNBQThCLEVBQzlCLHNCQUE4QyxFQUM5QyxPQUF5QixFQUN6QixXQUE2QixFQUM3QixRQUFtQixFQUNuQix3QkFBa0Q7UUFMbEQsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7UUFDOUMsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFDekIsZ0JBQVcsR0FBWCxXQUFXLENBQWtCO1FBQzdCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtJQUN4RCxDQUFDO0lBckJMLElBQUksT0FBTyxDQUFDLElBQVMsSUFBSSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7SUFBQSxDQUFDO0lBRXBELElBQUksY0FBYyxDQUFDLE9BQVksSUFBSSxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8s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MkM7QUFFbkQ7SUFEQyxLQUFLLEVBQUU7c0RBQ29EO0FBRTVEO0lBREMsS0FBSyxFQUFFO3VEQUN3RDtBQUVoRTtJQURDLEtBQUssRUFBRTt5REFHUDtBQUVEO0lBREMsS0FBSyxFQUFFO3dEQUdQO0FBckJVLGdCQUFnQjtJQUQ1QixTQUFTLENBQUMsRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLENBQUM7R0FDeEIsZ0JBQWdCLENBa0c1QjtTQWxHWSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE9uRGVzdHJveSxcbiAgQ29tcG9uZW50UmVmLFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIFRlbXBsYXRlUmVmLFxuICBSZW5kZXJlcjIsXG4gIEVtYmVkZGVkVmlld1JlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJsb2NrVUlDb250ZW50Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cy9ibG9jay11aS1jb250ZW50L2Jsb2NrLXVpLWNvbnRlbnQuY29tcG9uZW50JztcbmltcG9ydCB7IEJsb2NrVUlJbnN0YW5jZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9ibG9jay11aS1pbnN0YW5jZS5zZXJ2aWNlJztcbmltcG9ydCB7IEJsb2NrVUlEZWZhdWx0TmFtZSB9IGZyb20gJy4uL2NvbnN0YW50cy9ibG9jay11aS1kZWZhdWx0LW5hbWUuY29uc3RhbnQnO1xuaW1wb3J0IHsgQmxvY2tVSVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9ibG9jay11aS5zZXJ2aWNlJztcblxuQERpcmVjdGl2ZSh7IHNlbGVjdG9yOiAnW2Jsb2NrVUldJyB9KVxuZXhwb3J0IGNsYXNzIEJsb2NrVUlEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgYmxvY2tVSUNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPEJsb2NrVUlDb250ZW50Q29tcG9uZW50PjtcbiAgYmxvY2tUYXJnZXQ6IHN0cmluZztcbiAgbWVzc2FnZTogYW55O1xuICB0ZW1wbGF0ZTogYW55O1xuICBkZWxheVN0YXJ0OiBhbnk7XG4gIGRlbGF5U3RvcDogYW55O1xuXG4gIEBJbnB1dCgpXG4gIHNldCBibG9ja1VJKG5hbWU6IGFueSkgeyB0aGlzLmJsb2NrVGFyZ2V0ID0gbmFtZTsgfTtcbiAgQElucHV0KClcbiAgc2V0IGJsb2NrVUlNZXNzYWdlKG1lc3NhZ2U6IGFueSkgeyB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOyB9O1xuICBASW5wdXQoKVxuICBzZXQgYmxvY2tVSVRlbXBsYXRlKHRlbXBsYXRlOiBhbnkpIHsgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlOyB9O1xuICBASW5wdXQoKVxuICBzZXQgYmxvY2tVSURlbGF5U3RhcnQoZGVsYXlTdGFydDogYW55KSB7XG4gICAgdGhpcy5kZWxheVN0YXJ0ID0gZGVsYXlTdGFydCA/IE51bWJlcihkZWxheVN0YXJ0KSA6IG51bGw7XG4gIH07XG4gIEBJbnB1dCgpXG4gIHNldCBibG9ja1VJRGVsYXlTdG9wKGRlbGF5U3RvcDogYW55KSB7XG4gICAgdGhpcy5kZWxheVN0b3AgPSBkZWxheVN0b3AgPyBOdW1iZXIoZGVsYXlTdG9wKSA6IG51bGw7XG4gIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBibG9ja1VJU2VydmljZTogQmxvY2tVSVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBibG9ja1VJSW5zdGFuY2VTZXJ2aWNlOiBCbG9ja1VJSW5zdGFuY2VTZXJ2aWNlLFxuICAgIHByaXZhdGUgdmlld1JlZjogVmlld0NvbnRhaW5lclJlZixcbiAgICBwcml2YXRlIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+LFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyXG4gICkgeyB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMudmlld1JlZi5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50ZW1wbGF0ZVJlZik7XG4gICAgICBjb25zdCBwYXJlbnRFbGVtZW50ID0gdGhpcy5nZXRQYXJlbnRFbGVtZW50KCk7XG5cbiAgICAgIGlmIChwYXJlbnRFbGVtZW50ICYmICF0aGlzLmlzQ29tcG9uZW50SW5UZW1wbGF0ZShwYXJlbnRFbGVtZW50KSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHBhcmVudEVsZW1lbnQsICdibG9jay11aV9fZWxlbWVudCcpO1xuICAgICAgICB0aGlzLmJsb2NrVUlDb21wb25lbnRSZWYgPSB0aGlzLmNyZWF0ZUNvbXBvbmVudCgpO1xuICAgICAgICBsZXQgYmxvY2tVSUNvbnRlbnQgPSB0aGlzLmZpbmRDb250ZW50Tm9kZSh0aGlzLnZpZXdSZWYuZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcblxuICAgICAgICBpZiAoYmxvY2tVSUNvbnRlbnQpIHtcbiAgICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuYmxvY2tVSUluc3RhbmNlU2VydmljZS5nZXRTZXR0aW5ncygpO1xuXG4gICAgICAgICAgcGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChibG9ja1VJQ29udGVudCk7XG4gICAgICAgICAgdGhpcy5ibG9ja1VJQ29tcG9uZW50UmVmLmluc3RhbmNlLmNsYXNzTmFtZSA9ICdibG9jay11aS13cmFwcGVyLS1lbGVtZW50JztcbiAgICAgICAgICB0aGlzLmJsb2NrVUlDb21wb25lbnRSZWYuaW5zdGFuY2UubmFtZSA9IHRoaXMuYmxvY2tUYXJnZXQgfHwgQmxvY2tVSURlZmF1bHROYW1lO1xuICAgICAgICAgIGlmICh0aGlzLm1lc3NhZ2UpIHRoaXMuYmxvY2tVSUNvbXBvbmVudFJlZi5pbnN0YW5jZS5kZWZhdWx0TWVzc2FnZSA9IHRoaXMubWVzc2FnZTtcbiAgICAgICAgICBpZiAodGhpcy5kZWxheVN0YXJ0KSB0aGlzLmJsb2NrVUlDb21wb25lbnRSZWYuaW5zdGFuY2UuZGVsYXlTdGFydCA9IHRoaXMuZGVsYXlTdGFydDtcbiAgICAgICAgICBpZiAodGhpcy5kZWxheVN0b3ApIHRoaXMuYmxvY2tVSUNvbXBvbmVudFJlZi5pbnN0YW5jZS5kZWxheVN0b3AgPSB0aGlzLmRlbGF5U3RvcDtcbiAgICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZSB8fCBzZXR0aW5ncy50ZW1wbGF0ZSlcbiAgICAgICAgICAgIHRoaXMuYmxvY2tVSUNvbXBvbmVudFJlZi5pbnN0YW5jZS50ZW1wbGF0ZUNtcCA9IHRoaXMudGVtcGxhdGUgfHwgc2V0dGluZ3MudGVtcGxhdGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignbmctYmxvY2stdWk6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNDb21wb25lbnRJblRlbXBsYXRlKGVsZW1lbnQ6IGFueSk6IGJvb2xlYW4ge1xuICAgIC8vIE5lZWRlZCBiZWNhdXNlIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMjYyMzVcbiAgICBjb25zdCB0YXJnZXRFbGVtZW50ID0gZWxlbWVudCB8fCB7fTtcbiAgICBsZXQgeyBjaGlsZHJlbiB9ID0gdGFyZ2V0RWxlbWVudDtcbiAgICBjaGlsZHJlbiA9IEFycmF5LmZyb20oY2hpbGRyZW4gfHwgW10pLnJldmVyc2UoKTtcbiAgICByZXR1cm4gY2hpbGRyZW4uc29tZSgoZWw6IGFueSkgPT4gZWwgJiYgZWwubG9jYWxOYW1lID09PSAnYmxvY2stdWknKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UGFyZW50RWxlbWVudCgpOiBFbGVtZW50IHtcbiAgICBjb25zdCBlbWJlZGRlZFZpZXcgPSB0aGlzLnZpZXdSZWYuZ2V0KDApIGFzIEVtYmVkZGVkVmlld1JlZjxhbnk+O1xuXG4gICAgcmV0dXJuIGVtYmVkZGVkVmlldy5yb290Tm9kZXNbMF07XG5cbiAgfVxuXG4gIC8vIE5lZWRlZCBmb3IgSUUgKCMxNylcbiAgcHJpdmF0ZSBmaW5kQ29udGVudE5vZGUoZWxlbWVudDogYW55KSB7XG4gICAgY29uc3QgbmV4dFNpYmxpbmcgPSBlbGVtZW50Lm5leHRTaWJsaW5nIHx8IHt9O1xuICAgIGNvbnN0IHByZXZpb3VzU2libGluZyA9IGVsZW1lbnQucHJldmlvdXNTaWJsaW5nIHx8IHt9O1xuXG4gICAgcmV0dXJuIFtcbiAgICAgIG5leHRTaWJsaW5nLFxuICAgICAgbmV4dFNpYmxpbmcubmV4dFNpYmxpbmcsXG4gICAgICBwcmV2aW91c1NpYmxpbmcsXG4gICAgICBwcmV2aW91c1NpYmxpbmcucHJldmlvdXNTaWJsaW5nXG4gICAgXS5maW5kKChlKSA9PiBlICYmIGUubG9jYWxOYW1lID09PSAnYmxvY2stdWktY29udGVudCcpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDb21wb25lbnQoKSB7XG4gICAgY29uc3QgcmVzb2x2ZWRCbG9ja1VJQ29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoQmxvY2tVSUNvbnRlbnRDb21wb25lbnQpO1xuICAgIHJldHVybiB0aGlzLnZpZXdSZWYuY3JlYXRlQ29tcG9uZW50KHJlc29sdmVkQmxvY2tVSUNvbXBvbmVudCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5ibG9ja1RhcmdldCkge1xuICAgICAgdGhpcy5ibG9ja1VJU2VydmljZS5yZXNldCh0aGlzLmJsb2NrVGFyZ2V0KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==