!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs")):"function"==typeof define&&define.amd?define("ng-block-ui",["exports","@angular/core","@angular/common","rxjs"],e):e((t=t||self)["ng-block-ui"]={},t.ng.core,t.ng.common,t.rxjs)}(this,(function(t,e,n,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var i=function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e,n,o){var i,s=arguments.length,a=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var r=t.length-1;r>=0;r--)(i=t[r])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,s=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=s.next()).done;)a.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}var r=function(){function t(){}return t.START="start",t.STOP="stop",t.UPDATE="update",t.RESET="reset",t.RESET_GLOBAL="reset_global",t.UNSUBSCRIBE="unsubscribe",t}(),c=function(){function t(){this.blockUISettings={},this.blockUIInstances={},this.blockUISubject=new o.ReplaySubject(1),this.blockUIObservable=this.blockUISubject.asObservable(),this.blockUIObservable.subscribe(this.blockUIMiddleware.bind(this))}return t.prototype.getSettings=function(){return this.blockUISettings},t.prototype.updateSettings=function(t){void 0===t&&(t={}),this.blockUISettings=i(i({},this.blockUISettings),t)},t.prototype.decorate=function(t){void 0===t&&(t="block-ui-main");var e={name:t,isActive:!1,blockCount:0,start:this.dispatch(this.blockUISubject,r.START,t),update:this.dispatch(this.blockUISubject,r.UPDATE,t),stop:this.dispatch(this.blockUISubject,r.STOP,t),reset:this.dispatch(this.blockUISubject,r.RESET,t),resetGlobal:this.dispatch(this.blockUISubject,r.RESET_GLOBAL,t),unsubscribe:this.dispatch(this.blockUISubject,r.UNSUBSCRIBE,t)};return this.blockUIInstances[t]=this.blockUIInstances[t]||e,e},t.prototype.observe=function(){return this.blockUIObservable},t.prototype.clearInstance=function(t){this.dispatch(this.blockUISubject,r.RESET,t)},t.prototype.blockUIMiddleware=function(t){var e=t.action,n=t.name,o=null;switch(e){case r.START:o=!0;break;case r.STOP:case r.RESET:o=!1}null!==o&&(this.blockUIInstances[n].isActive=o)},t.prototype.dispatch=function(t,e,n){return void 0===n&&(n="block-ui-main"),function(o){t.next({name:n,action:e,message:o})}},t=s([e.Injectable()],t)}(),l=function(){function t(t){this.blockUI=t}return t.prototype.ngOnInit=function(){this.name=this.name||"block-ui-main",this.template=this.template||this.blockUI.blockUISettings.template},t.ctorParameters=function(){return[{type:c}]},s([e.Input()],t.prototype,"name",void 0),s([e.Input()],t.prototype,"message",void 0),s([e.Input()],t.prototype,"delayStart",void 0),s([e.Input()],t.prototype,"delayStop",void 0),s([e.Input()],t.prototype,"template",void 0),t=s([e.Component({selector:"block-ui",template:'\n    <ng-content></ng-content>\n    <block-ui-content\n      [name]="name"\n      [message]="message"\n      [template]="template"\n      [delayStart]="delayStart"\n      [delayStop]="delayStop"\n    >\n    </block-ui-content>\n  ',encapsulation:e.ViewEncapsulation.None})],t)}(),p="\n.block-ui-wrapper {\n  display: none;\n  position: fixed;\n  height: 100%;\n  width: 100%;\n  top: 0;\n  left: 0;\n  background: rgba(0, 0, 0, 0.70);\n  z-index: 30000;\n  cursor: wait;\n}\n\n.block-ui-wrapper.block-ui-wrapper--element {\n  position: absolute;\n}\n\n.block-ui-wrapper.active {\n  display: block;\n}\n\n.block-ui-wrapper.block-ui-main {\n  position: fixed;\n}\n\n.block-ui-spinner,\n.block-ui-template {\n  position: absolute;\n  top: 40%;\n  margin: 0 auto;\n  left: 0;\n  right: 0;\n  transform: translateY(-50%);\n}\n\n.block-ui-spinner > .message {\n  font-size: 1.3em;\n  text-align: center;\n  color: #fff;\n}\n\n.block-ui__element {\n  position: relative;\n}\n\n.loader,\n.loader:after {\n  border-radius: 50%;\n  width: 10em;\n  height: 10em;\n}\n.loader {\n  margin: 7px auto;\n  font-size: 5px;\n  position: relative;\n  text-indent: -9999em;\n  border-top: 1.1em solid rgba(255, 255, 255, 0.2);\n  border-right: 1.1em solid rgba(255, 255, 255, 0.2);\n  border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);\n  border-left: 1.1em solid #ffffff;\n  -webkit-transform: translateZ(0);\n  -ms-transform: translateZ(0);\n  transform: translateZ(0);\n  -webkit-animation: load8 1.1s infinite linear;\n  animation: load8 1.1s infinite linear;\n}\n\n@-webkit-keyframes load8 {\n  0% {\n    -webkit-transform: rotate(0deg);\n    transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes load8 {\n  0% {\n    -webkit-transform: rotate(0deg);\n    transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n",u='\n<div class="block-ui-wrapper {{name}} {{className}}" [ngClass]="{ \'active\': state.blockCount > 0 }">\n  <div class="block-ui-spinner" *ngIf="!templateCmp">\n    <div class="loader"></div>\n    <div *ngIf="message || defaultMessage" class="message">\n      {{ message || defaultMessage }}\n    </div>\n  </div>\n  <ng-template *ngIf="templateCmp" #templateOutlet></ng-template>\n</div>\n',h=function(){function t(t,e,n){this.blockUI=t,this.resolver=e,this.changeDetectionRef=n,this.name="block-ui-main",this.defaultBlockState={startTimeouts:[],stopTimeouts:[],updateTimeouts:[],blockCount:0,startCallCount:0,stopCallCount:0},this.state=i({},this.defaultBlockState)}return t.prototype.ngOnInit=function(){this.settings=this.blockUI.getSettings(),this.blockUISubscription=this.subscribeToBlockUI(this.blockUI.observe())},t.prototype.ngAfterViewInit=function(){try{if(!this.templateCmp)return!1;if(this.templateCmp instanceof e.TemplateRef)this.templateOutlet.createEmbeddedView(this.templateCmp);else{var t=this.resolver.resolveComponentFactory(this.templateCmp);this.templateCompRef=this.templateOutlet.createComponent(t),this.updateBlockTemplate(this.message)}}catch(t){console.error("ng-block-ui:",t)}},t.prototype.ngAfterViewChecked=function(){this.detectChanges()},t.prototype.subscribeToBlockUI=function(t){var e=this;return t.subscribe((function(t){return e.onDispatchedEvent(t)}))},t.prototype.onDispatchedEvent=function(t){switch(t.action){case r.START:this.onStart(t);break;case r.STOP:this.onStop(t);break;case r.UPDATE:this.onUpdate(t);break;case r.RESET:this.onReset(t);break;case r.RESET_GLOBAL:this.resetState();break;case r.UNSUBSCRIBE:this.onStop(t),this.onUnsubscribe(t.name)}},t.prototype.onStart=function(t){var e=this,n=t.name,o=t.message;if(n===this.name){var i=this.delayStart||this.settings.delayStart||0;this.state.startCallCount+=1;var s=setTimeout((function(){e.state.blockCount+=1,e.showBlock(o),e.updateInstanceBlockCount()}),i);this.state.startTimeouts.push(s)}},t.prototype.onStop=function(t){var e=this;if(t.name===this.name){var n=this.state.stopCallCount+1;if(this.state.startCallCount-n>=0){var o=this.delayStop||this.settings.delayStop||0;this.state.stopCallCount=n;var i=setTimeout((function(){e.state.blockCount-=1,e.updateInstanceBlockCount(),e.detectChanges()}),o);this.state.stopTimeouts.push(i)}}},t.prototype.onUpdate=function(t){var e=this,n=t.name,o=t.message;if(n===this.name){var i=this.delayStart||this.settings.delayStart||0;clearTimeout(this.state.updateTimeouts[0]);var s=setTimeout((function(){e.updateMessage(o)}),i);this.state.updateTimeouts.push(s)}},t.prototype.onReset=function(t){t.name===this.name&&this.resetState()},t.prototype.updateMessage=function(t){this.showBlock(t)},t.prototype.showBlock=function(t){this.message=t||this.defaultMessage||this.settings.message,this.updateBlockTemplate(this.message),this.detectChanges()},t.prototype.updateBlockTemplate=function(t){this.templateCompRef&&this.templateCompRef instanceof e.ComponentRef&&(this.templateCompRef.instance.message=t)},t.prototype.resetState=function(){(function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t})(this.state.startTimeouts,this.state.stopTimeouts,this.state.updateTimeouts).forEach(clearTimeout),this.state=i({},this.defaultBlockState),this.updateInstanceBlockCount(),this.detectChanges()},t.prototype.onUnsubscribe=function(t){this.blockUISubscription&&t===this.name&&this.blockUISubscription.unsubscribe()},t.prototype.updateInstanceBlockCount=function(){if(this.blockUI.blockUIInstances[this.name]){var t=this.state.blockCount;this.blockUI.blockUIInstances[this.name].blockCount=t}},t.prototype.detectChanges=function(){this.changeDetectionRef.destroyed||this.changeDetectionRef.detectChanges()},t.prototype.ngOnDestroy=function(){this.resetState(),this.onUnsubscribe(this.name),this.blockUI.clearInstance(this.name)},t.ctorParameters=function(){return[{type:c},{type:e.ComponentFactoryResolver},{type:e.ChangeDetectorRef}]},s([e.Input()],t.prototype,"name",void 0),s([e.Input()],t.prototype,"delayStart",void 0),s([e.Input()],t.prototype,"delayStop",void 0),s([e.Input("message")],t.prototype,"defaultMessage",void 0),s([e.Input("template")],t.prototype,"templateCmp",void 0),s([e.ViewChild("templateOutlet",{read:e.ViewContainerRef})],t.prototype,"templateOutlet",void 0),t=s([e.Component({selector:"block-ui-content",template:u,encapsulation:e.ViewEncapsulation.None,styles:[p]})],t)}(),b=function(){function t(t){this.blockUIInstance=t,this.globalDispatch=this.blockUIInstance.decorate()}return t.prototype.start=function(t,e){this.dispatch(t,r.START,e)},t.prototype.stop=function(t){this.dispatch(t,r.STOP)},t.prototype.reset=function(t){this.dispatch(t,r.RESET)},t.prototype.resetGlobal=function(){this.globalDispatch.resetGlobal()},t.prototype.update=function(t,e){this.dispatch(t,r.UPDATE,e)},t.prototype.unsubscribe=function(t){this.dispatch(t,r.UNSUBSCRIBE)},t.prototype.isActive=function(t){void 0===t&&(t=null);var e=t?this.toArray(t):null,n=this.blockUIInstance.blockUIInstances;return Object.keys(n).some((function(t){return e?e.indexOf(n[t].name)>=0&&n[t].isActive:n[t].isActive}))},t.prototype.dispatch=function(t,e,n){var o=this;void 0===t&&(t=[]),this.toArray(t).forEach((function(t){return o.blockUIInstance.decorate(t)[e](n)}))},t.prototype.toArray=function(t){return void 0===t&&(t=[]),"string"==typeof t?[t]:t},t.ctorParameters=function(){return[{type:c}]},t=s([e.Injectable()],t)}(),f=function(){function t(t,e,n,o,i,s){this.blockUIService=t,this.blockUIInstanceService=e,this.viewRef=n,this.templateRef=o,this.renderer=i,this.componentFactoryResolver=s}return Object.defineProperty(t.prototype,"blockUI",{set:function(t){this.blockTarget=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blockUIMessage",{set:function(t){this.message=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blockUITemplate",{set:function(t){this.template=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blockUIDelayStart",{set:function(t){this.delayStart=t?Number(t):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blockUIDelayStop",{set:function(t){this.delayStop=t?Number(t):null},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){try{this.viewRef.createEmbeddedView(this.templateRef);var t=this.getParentElement();if(t&&!this.isComponentInTemplate(t)){this.renderer.addClass(t,"block-ui__element"),this.blockUIComponentRef=this.createComponent();var e=this.findContentNode(this.viewRef.element.nativeElement);if(e){var n=this.blockUIInstanceService.getSettings();t.appendChild(e),this.blockUIComponentRef.instance.className="block-ui-wrapper--element",this.blockUIComponentRef.instance.name=this.blockTarget||"block-ui-main",this.message&&(this.blockUIComponentRef.instance.defaultMessage=this.message),this.delayStart&&(this.blockUIComponentRef.instance.delayStart=this.delayStart),this.delayStop&&(this.blockUIComponentRef.instance.delayStop=this.delayStop),(this.template||n.template)&&(this.blockUIComponentRef.instance.templateCmp=this.template||n.template)}}}catch(t){console.error("ng-block-ui:",t)}},t.prototype.isComponentInTemplate=function(t){var e=(t||{}).children;return(e=Array.from(e||[]).reverse()).some((function(t){return t&&"block-ui"===t.localName}))},t.prototype.getParentElement=function(){return this.viewRef.get(0).rootNodes[0]},t.prototype.findContentNode=function(t){var e=t.nextSibling||{},n=t.previousSibling||{};return[e,e.nextSibling,n,n.previousSibling].find((function(t){return t&&"block-ui-content"===t.localName}))},t.prototype.createComponent=function(){var t=this.componentFactoryResolver.resolveComponentFactory(h);return this.viewRef.createComponent(t)},t.prototype.ngOnDestroy=function(){this.blockTarget&&this.blockUIService.reset(this.blockTarget)},t.ctorParameters=function(){return[{type:b},{type:c},{type:e.ViewContainerRef},{type:e.TemplateRef},{type:e.Renderer2},{type:e.ComponentFactoryResolver}]},s([e.Input()],t.prototype,"blockUI",null),s([e.Input()],t.prototype,"blockUIMessage",null),s([e.Input()],t.prototype,"blockUITemplate",null),s([e.Input()],t.prototype,"blockUIDelayStart",null),s([e.Input()],t.prototype,"blockUIDelayStop",null),t=s([e.Directive({selector:"[blockUI]"})],t)}(),m=new c,d=new e.InjectionToken("BlockUIModuleSettings");function y(t){return m.updateSettings(t),m}var k=function(){function t(){}var o;return o=t,t.forRoot=function(t){return void 0===t&&(t={}),{ngModule:o,providers:[{provide:d,useValue:t},{provide:c,useFactory:y,deps:[d]},b]}},t=o=s([e.NgModule({imports:[n.CommonModule],entryComponents:[l,h],declarations:[l,f,h],exports:[l,f,h]})],t)}(),g=1;t.BLOCKUI_DEFAULT="block-ui-main",t.BlockUI=function(t,e){return void 0===e&&(e={}),e.scopeToInstance?function(e,n){var o="_"+n+"-block-ui";Object.defineProperty(e,n,{get:function(){if(this[o])return this[o];var e=t+"-"+g++;return this[o]=m.decorate(e),this[o]},set:function(t){this[o]=t}})}:function(e,n){e[n]=m.decorate(t)}},t.BlockUIComponent=l,t.BlockUIContentComponent=h,t.BlockUIModule=k,t.BlockUIService=b,t.ɵa=d,t.ɵb=y,t.ɵc=c,t.ɵd=u,t.ɵe=p,t.ɵf=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-block-ui.umd.min.js.map