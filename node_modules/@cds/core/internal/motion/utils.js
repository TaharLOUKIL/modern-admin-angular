import{CLARITY_MOTION_REVERSE_ANIMATION_SUFFIX as t,AnimationStatus as n,CLARITY_MOTION_REVERSE_ANIMATION_LABEL as i,CLARITY_MOTION_FALLBACK_EASING as o,CLARITY_MOTION_FALLBACK_DURATION_IN_MS as r,CLARITY_MOTION_ENTER_LEAVE_PROPERTY as e}from"./interfaces.js";import{LogService as s}from"../services/log.service.js";import{ClarityMotion as u}from"./motion.service.js";import a from"ramda/es/clone.js";import{isCssPropertyName as c,getCssPropertyValue as f}from"../utils/css.js";import{isSuffixedBy as l,getNumericValueFromCssSecondsStyleValue as m,isPrefixedBy as d,removePrefix as p}from"../utils/string.js";import{queryChildFromLightOrShadowDom as h}from"../utils/dom.js";import{allPropertiesPass as g,getMillisecondsFromSeconds as v}from"../utils/identity.js";async function y(t,n){if(!n._animations)return s.warn(n.tagName.toLocaleLowerCase()+" is trying to animate but no animations are defined."),!1;const i=z(n._animations,t);return await Promise.all(i.map((i=>{const[o,r]=i;if(t.get(o)===n[o])return!1;const e=r[n[o].toString()],s=n.cdsMotion,[u,c]=M(e,x(s,o,n[o].toString()));let f=a(c);if(f.length<1)return!1;f=O(u,f,n);const l=A(e,f,n);return Promise.all(l).then((()=>(j(e,n),!0)))}))).then((t=>t.indexOf(!0)>-1)).catch((()=>!1))}function w(t,i){i.getAttribute("_cds-animation-status")!==n.active&&(i.setAttribute("_cds-animation-status",n.active),i.cdsMotionChange.emit(`${t} animation ${n.start}`))}function j(t,i){i.setAttribute("_cds-animation-status",n.ready),i.cdsMotionChange.emit(`${t} animation ${n.end}`)}function O(t,n,i){const o=i.cdsMotion,r=!o||"off"===o;return b(t)&&(n=C(n)),r?B(n):$(n=N(n,i),i)}function A(t,n,i){return n.filter((t=>!t.onlyIf||g(i,t.onlyIf))).map((n=>(w(t,i),new Promise((t=>{const o=P(i,n.target).animate(S(n.animation,i),n.options||{}),r=()=>{t("animation finished"),o.removeEventListener("finish",r)};o.addEventListener("finish",r)})))))}function P(t,n){return h(t,n)||t}function S(t,n){return Array.isArray(t)?R(t,n):t}function b(n){return l(n,t)}function C(t){return t.map((t=>(t.options?t.options.direction=i:t.options={direction:i},t)))}function _(t){return t+"-"+i}function x(t,n,i){if(!t||!n||void 0===i)return"";if("on"===t||"off"===t)return"";let o;try{o=JSON.parse(t)}catch(t){return""}return o[n]&&o[n][i]||""}function E(n){return b(n)?n.slice(0,-1*t.length):n}function L(t,n){return n&&u.has(E(n))?n:t}function M(t,n){const i=L(t,n);return[i,a(u.get(E(i)))]}function N(t,n){return I("duration",n,t,r,(t=>v(m(t))))}function $(t,n){return I("easing",n,t,o)}function B(t){return t.map((t=>(t.options?(t.options.duration=0,t.options.easing=o):t.options={duration:0,easing:o},t)))}function I(t,n,i,o,r){return i.map((i=>{if(i.options)if(i.options[t]){if(c(i.options[t])){const e=i.options[t];let s=f(e,n);s?r&&(s=r(s)):s=o,i.options[t]=s}}else i.options[t]=o;else{const n={};n[t]=o,i.options=n}return i}))}function R(t,n){return Array.isArray(t)?t.map((t=>{var i,o,r,e;if((null==t?void 0:t.hasOwnProperty("height"))&&d((null===(i=null==t?void 0:t.height)||void 0===i?void 0:i.toString())||"","from:")){const i=p((null===(o=null==t?void 0:t.height)||void 0===o?void 0:o.toString())||"","from:"),r=h(n,i)||null;t.height=r?r.getBoundingClientRect().height+"px":"auto"}if((null==t?void 0:t.hasOwnProperty("width"))&&d((null===(r=null==t?void 0:t.width)||void 0===r?void 0:r.toString())||"","from:")){const i=p((null===(e=null==t?void 0:t.width)||void 0===e?void 0:e.toString())||"","from:"),o=h(n,i)||null;t.width=o?o.getBoundingClientRect().width+"px":"auto"}return t})):t}function J(t,n){if(null==t)return null;let i=!0;const o={};return Object.getOwnPropertyNames(t).forEach((r=>{n.has(r)&&(o[r]=a(t[r]),i=!1)})),i?null:o}function k(t,n){if(null==t)return[];const[i,o]=t;return i.length>0?n?[].concat(o,i):[].concat(i,o):o}function q(t){const n=[],i=[];return Object.getOwnPropertyNames(t||{}).forEach((o=>{const r=[o,a(t[o])];o===e?n.push(r):i.push(r)})),[n,i]}function z(t,n){const i=J(t||{},n);return null===i?[]:k(q(i),n.get(e))}export{b as animationIsReversed,E as extractAnimationNameIfReversed,J as filterAnimationsByUpdatedProperties,k as flattenAndSortAnimations,M as getAnimationConfigForPropertyValue,L as getAnimationFromOverrideOrDecorator,S as getAnimationKeyframesOrPropertyIndexedFrames,A as getAnimationPromiseInstructions,P as getAnimationTarget,q as getHidingAndNonHidingPropertyAnimations,x as getInlineOverride,z as getPropertyAnimations,j as resolveAnimationEndStatus,_ as reverseAnimation,C as reverseAnimationConfig,y as runPropertyAnimations,O as setAnimationConfigOptions,N as setAnimationDuration,$ as setAnimationEasing,I as setAnimationProperty,w as setAnimationStartStatus,R as sizeDimensionKeyframes,B as zeroOutAnimationConfig};
//# sourceMappingURL=utils.js.map
