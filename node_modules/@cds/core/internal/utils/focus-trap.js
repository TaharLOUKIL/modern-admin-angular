import{LitElement as t}from"lit";import{FocusTrapTracker as e,CDS_FOCUS_TRAP_ID_ATTR as o}from"../services/focus-trap-tracker.service.js";import{isFocusable as n,isHTMLElement as s}from"./dom.js";import{createId as r}from"./identity.js";function i(t,o,n){const s=e.getCurrent()===o,r=u(t,o);s&&r?(n=n||o).focus():t.focus()}function u(t,e){return t===e.topReboundElement||t===e.bottomReboundElement||!(e.contains(t)||null!==e.shadowRoot&&e.shadowRoot.contains(t))}function c(){const t=document.createElement("span");return t.setAttribute("tabindex","0"),t.classList.add("offscreen-focus-rebounder"),t}function m(t){if(t&&!t.topReboundElement&&!t.bottomReboundElement){t.topReboundElement=c(),t.bottomReboundElement=c();const e=t.parentElement,o=t.nextSibling;e&&(e.insertBefore(t.topReboundElement,t),o?e.insertBefore(t.bottomReboundElement,o):e.appendChild(t.bottomReboundElement))}}function a(t){if(t){const e=t.parentElement;if(e){const o=t.topReboundElement,n=t.bottomReboundElement;o&&e.removeChild(o),n&&e.removeChild(n)}delete t.topReboundElement,delete t.bottomReboundElement}}function d(t){return t}class l{constructor(e){this.active=!1,(e=e).focusTrapId||(e.focusTrapId=r()),e instanceof t||e.hasAttribute(o)||e.setAttribute(o,e.focusTrapId),this.focusTrapElement=e}enableFocusTrap(){const t=this.focusTrapElement,o=t.querySelector("[cds-first-focus]"),r=t.shadowRoot?t.shadowRoot.querySelector(".private-host[tabindex]"):null,i=document.activeElement;if(e.getCurrent()===t)throw Error("Focus trap is already enabled for this instance.");this.firstFocusElement=o||r||this.focusTrapElement,m(t),n(t)||t.setAttribute("tabindex","-1"),i&&s(i)&&(this.previousFocus=i),e.setCurrent(t.focusTrapId);const u=setTimeout((()=>{this.firstFocusElement.focus(),clearTimeout(u)}),10);this.onFocusInEvent=this.onFocusIn.bind(this),document.addEventListener("focusin",this.onFocusInEvent),this.active=!0}removeFocusTrap(){document.removeEventListener("focusin",this.onFocusInEvent),a(this.focusTrapElement),e.activatePreviousCurrent(),this.active=!1,this.previousFocus&&this.previousFocus.focus()}onFocusIn(t){i(t.composedPath()[0],this.focusTrapElement,this.firstFocusElement)}}export{l as FocusTrap,m as addReboundElementsToFocusTrapElement,d as castHtmlElementToFocusTrapElement,c as createFocusTrapReboundElement,u as elementIsOutsideFocusTrapElement,i as refocusIfOutsideFocusTrapElement,a as removeReboundElementsFromFocusTrapElement};
//# sourceMappingURL=focus-trap.js.map
