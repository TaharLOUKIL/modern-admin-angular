import{__decorate as t}from"tslib";import{LitElement as e,html as i}from"lit";import{query as s}from"lit/decorators/query.js";import{getElementLanguageDirection as o,baseStyles as l,syncProps as a,describeElementByElements as r,getElementUpdates as n,childrenUpdateComplete as d,pxToRem as p,updateComponentLayout as u,property as h,state as c,querySlot as y,querySlotAll as f,id as v,event as m}from"@cds/core/internal";import{ClarityIcons as b}from"@cds/core/icon/icon.service.js";import{exclamationCircleIcon as g}from"@cds/core/icon/shapes/exclamation-circle.js";import{checkCircleIcon as x}from"@cds/core/icon/shapes/check-circle.js";import C from"./control.element.scss.js";import{syncHTML5Validation as L}from"../utils/validate.js";import{defaultControlWidth as A,defaultFormLayout as T,getStatusIcon as $,associateInputAndLabel as k,associateInputToDatalist as S,getCurrentMessageStatus as B,controlIsWrapped as R,formLayouts as z}from"../utils/index.js";var D;!function(t){t.default="default",t.ariaLabel="aria-label",t.inputGroup="input-group",t.hiddenLabel="hidden-label"}(D||(D={}));class W extends e{constructor(){super(),this.status="neutral",this.controlWidth=A,this.validate=!1,this.responsive=!0,this._layout=T,this.focused=!1,this.disabled=!1,this.readonly=!1,this.fixedControlWidth=!1,this.supportsPrefixSuffixActions=!0,this.labelLayout=D.default,this.observers=[],b.addIcons(g,x)}get layout(){return this._layout}set layout(t){const e=this._layout;this._layout=t?t.replace("-inline",""):T,this.requestUpdate("layout",e)}get isRTL(){return"rtl"===o(this)}static get styles(){return[l,C]}render(){var t;return i`${this.labelLayout===D.hiddenLabel||this.labelLayout===D.inputGroup?i`<span cds-layout="display:screen-reader-only"><slot name="label"></slot></span>`:""}<div cds-layout="${"vertical"===this.layout?"vertical gap:sm":"horizontal gap:lg"} align:stretch" class="private-host ${this.isRTL?"rtl":""}">${this.primaryLabelTemplate}<div cds-layout="
          ${"compact"===this.layout?"horizontal":"vertical"}
          ${"stretch"!==this.controlWidth||this.fixedControlWidth?"":"align:horizontal-stretch"}
          ${(null===(t=this.messages)||void 0===t?void 0:t.length)?"gap:sm":""}"><div cds-layout="horizontal gap:sm wrap:none"><div cds-layout="horizontal align:top wrap:none ${"shrink"===this.controlWidth||this.fixedControlWidth?"align:shrink":"align:horizontal-stretch"}" class="input-container">${this.inputTemplate} ${this.prefixTemplate}<slot name="input"></slot>${this.suffixTemplate}</div>${this.labelLayout!==D.inputGroup?$(this.status):""}</div>${this.messagesTemplate}</div></div>`}get inputTemplate(){return i``}get prefixDefaultTemplate(){return null}get suffixDefaultTemplate(){return null}get hasControlActions(){return this.controlActions.length>0||this.prefixDefaultTemplate||this.suffixDefaultTemplate}get primaryLabelTemplate(){return i`${this.labelLayout===D.default?i`<cds-internal-control-label .disabled="${this.disabled}" cds-layout="align:shrink align:top" action="primary"><slot name="label"></slot></cds-internal-control-label>`:""}`}get messagesTemplate(){return i`<div cds-layout="${"compact"===this.layout?"align:shrink":""}" class="messages"><slot name="message"></slot></div>`}get prefixTemplate(){return i`<div cds-layout="align:shrink align:vertical-center" class="prefix"><div cds-layout="horizontal gap:xs">${this.prefixDefaultTemplate}<slot name="prefix"></slot></div></div>`}get suffixTemplate(){return i`<div cds-layout="align:shrink align:vertical-center" class="suffix"><div cds-layout="horizontal gap:xs"><slot name="suffix"></slot>${this.suffixDefaultTemplate}</div></div>`}connectedCallback(){super.connectedCallback(),this.setAttribute("cds-control","")}firstUpdated(t){super.firstUpdated(t),k(this.inputControl,this.label,this.inputControlId),S(this.inputControl,this.datalistControl),this.setupHostAttributes(),this.setupHTML5Validation(),this.setActionOffsetPadding(),this.setupResponsive(),this.setupDescribedByUpdates(),this.setupLabelLayout(),this.assignSlotIfInControlGroup()}updated(t){super.updated(t),this.messages.forEach((e=>a(e,this,{disabled:t.has("disabled")}))),a(this.inputControl,this,{disabled:t.has("disabled")})}disconnectedCallback(){super.disconnectedCallback(),this.observers.forEach((t=>t.disconnect()))}setupDescribedByUpdates(){var t;null===(t=this.messageSlot)||void 0===t||t.addEventListener("slotchange",(async()=>{r(this.inputControl,Array.from(this.messages)),B(Array.from(this.messages)).then((t=>this.status=t))}))}setupHostAttributes(){this.inputControl.addEventListener("focusin",(()=>this.focused=!0)),this.inputControl.addEventListener("focusout",(()=>this.focused=!1)),this.observers.push(n(this.inputControl,"disabled",(t=>this.disabled=""===t||t)),n(this.inputControl,"readonly",(t=>this.readonly=""===t||t)))}setupHTML5Validation(){var t,e;!(null===(e=null===(t=this.inputControl)||void 0===t?void 0:t.form)||void 0===e?void 0:e.noValidate)&&this.validate&&L(this,Array.from(this.messages))}async setActionOffsetPadding(){if(await d(this.controlActions),this.supportsPrefixSuffixActions&&this.hasControlActions){const t=p(this.prefixAction.getBoundingClientRect().width+6),e=p(this.suffixAction.getBoundingClientRect().width+6);this.inputControl.style.setProperty("padding-left",this.isRTL?e:t,"important"),this.inputControl.style.setProperty("padding-right",this.isRTL?t:e,"important")}}get layoutStable(){return this.labelLayout!==D.default||!R(this.inputControl,this.controlLabel,this.layout)}setupResponsive(){if(this.responsive&&this.labelLayout===D.default&&this.controlLabel){const t={layouts:z,initialLayout:this.layout},e=u(this,t,(()=>this.layoutChange.emit(this.layout,{bubbles:!0})));this.observers.push(e)}}setupLabelLayout(){var t,e;(null===(e=null===(t=this.label)||void 0===t?void 0:t.getAttribute("cds-layout"))||void 0===e?void 0:e.includes("display:screen-reader-only"))&&(this.labelLayout=D.hiddenLabel),this.inputControl.hasAttribute("aria-label")&&(this.labelLayout=D.ariaLabel)}assignSlotIfInControlGroup(){var t;(null===(t=this.parentElement)||void 0===t?void 0:t.hasAttribute("cds-control-group"))&&this.setAttribute("slot","controls")}}t([h({type:String})],W.prototype,"status",void 0),t([h({type:String})],W.prototype,"controlWidth",void 0),t([h({type:Boolean})],W.prototype,"validate",void 0),t([h({type:Boolean})],W.prototype,"responsive",void 0),t([h({type:String})],W.prototype,"layout",null),t([c({type:Boolean,reflect:!0})],W.prototype,"focused",void 0),t([c({type:Boolean,reflect:!0})],W.prototype,"disabled",void 0),t([c({type:Boolean,reflect:!0})],W.prototype,"readonly",void 0),t([c()],W.prototype,"fixedControlWidth",void 0),t([c()],W.prototype,"supportsPrefixSuffixActions",void 0),t([c()],W.prototype,"isRTL",null),t([c()],W.prototype,"labelLayout",void 0),t([y("input, select, textarea, [cds-control]",{required:"error",requiredMessage:"input element is missing",assign:"input"})],W.prototype,"inputControl",void 0),t([y("label",{required:"error",requiredMessage:"To meet a11y standards either a <label> or input[aria-label] should be provided.",assign:"label",exemptOn:t=>{var e;return null===(e=t.inputControl)||void 0===e?void 0:e.hasAttribute("aria-label")}})],W.prototype,"label",void 0),t([s("cds-internal-control-label[action=primary]")],W.prototype,"controlLabel",void 0),t([y("datalist")],W.prototype,"datalistControl",void 0),t([f("cds-control-message")],W.prototype,"messages",void 0),t([f("cds-control-action")],W.prototype,"controlActions",void 0),t([v()],W.prototype,"inputControlId",void 0),t([s(".prefix")],W.prototype,"prefixAction",void 0),t([s(".suffix")],W.prototype,"suffixAction",void 0),t([s(".messages")],W.prototype,"messageSlot",void 0),t([m()],W.prototype,"layoutChange",void 0);export{W as CdsControl,D as ControlLabelLayout};
//# sourceMappingURL=control.element.js.map
